import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { useApp } from '../context/AppContext';
import { useTranslation } from '../utils/translations';
import { motion } from 'framer-motion';
import { registerPatient } from '../services/authService';

export default function PatientRegistration() {
  const navigate = useNavigate();
  const { state, actions } = useApp();
  const t = useTranslation(state.lang);

  const [formData, setFormData] = useState({
    fullName: '',
    dateOfBirth: '',
    aadharNumber: '',
    phoneNumber: '',
    gender: '',
    email: '',
    password: '',
    confirmPassword: ''
  });

  const [errors, setErrors] = useState({});
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showPassword, setShowPassword] = useState(false);
  const [showConfirmPassword, setShowConfirmPassword] = useState(false);
  const [submitError, setSubmitError] = useState('');
  const [submitSuccess, setSubmitSuccess] = useState('');

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
    if (errors[name]) setErrors(prev => ({ ...prev, [name]: '' }));
  };


  // Strong password validation function
  const validateStrongPassword = (password) => {
    const minLength = 8;
    const hasUpperCase = /[A-Z]/.test(password);
    const hasLowerCase = /[a-z]/.test(password);
    const hasNumbers = /\d/.test(password);
    const hasSpecialChar = /[!@#$%^&*]/.test(password);

    if (password.length < minLength) {
      return 'Password must be at least 8 characters long';
    }
    if (!hasUpperCase) {
      return 'Password must include at least 1 uppercase letter';
    }
    if (!hasLowerCase) {
      return 'Password must include at least 1 lowercase letter';
    }
    if (!hasNumbers) {
      return 'Password must include at least 1 number';
    }
    if (!hasSpecialChar) {
      return 'Password must include at least 1 special character (!@#$%^&*)';
    }
    return null; // Password is valid
  };

  // Strong password validation function
    setOtpMessage('Verifying OTP...');

    try {
      const credential = PhoneAuthProvider.credential(confirmationResult.verificationId, otpString);
      await signInWithCredential(auth, credential);
      
      setOtpVerified(true);
      setOtpMessage('‚úÖ Phone number verified successfully');
    } catch (error) {
      console.error('OTP verification error:', error);
      setOtpVerified(false);
      
      let errorMessage = '‚ùå OTP verification failed. ';
      if (error.code === 'auth/invalid-verification-code') {
        errorMessage += 'Invalid OTP code.';
      } else if (error.code === 'auth/code-expired') {
        errorMessage += 'OTP expired. Please request a new one.';
      } else if (error.code === 'auth/too-many-requests') {
        errorMessage += 'Too many attempts. Please try again later.';
      } else {
        errorMessage += error.message || 'Please try again.';
      }
      
      setOtpMessage(errorMessage);
    } finally {
      setOtpVerifying(false);
    }
  };

  const validateForm = () => {
    const newErrors = {};

    if (!formData.fullName.trim()) newErrors.fullName = 'Full name is required';

    if (!formData.dateOfBirth) newErrors.dateOfBirth = 'Date of birth is required';

    if (!formData.aadharNumber.trim()) {
      newErrors.aadharNumber = 'Aadhar number is required';
    } else if (!/^\d{12}$/.test(formData.aadharNumber.trim())) {
      newErrors.aadharNumber = 'Aadhar must be a 12-digit number';
    }

    if (!formData.phoneNumber.trim()) {
      newErrors.phoneNumber = 'Phone number is required';
    } else if (!/^[+]?\d[\d\s\-()]{9,14}$/.test(formData.phoneNumber.trim())) {
      newErrors.phoneNumber = 'Enter a valid phone number';
    }

    if (!formData.gender) newErrors.gender = 'Please select a gender';

    if (!formData.email.trim()) {
      newErrors.email = 'Email is required';
    } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(formData.email.trim())) {
      newErrors.email = 'Enter a valid email address';
    }

    // Strong password validation
    if (!formData.password) {
      newErrors.password = 'Password is required';
    } else {
      const passwordError = validateStrongPassword(formData.password);
      if (passwordError) {
        newErrors.password = passwordError;
      }
    }

    // Confirm password validation
    if (!formData.confirmPassword) {
      newErrors.confirmPassword = 'Please confirm your password';
    } else if (formData.password !== formData.confirmPassword) {
      newErrors.confirmPassword = 'Passwords do not match';
    }

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!validateForm()) return;
    setSubmitError('');
    setSubmitSuccess('');
    setIsSubmitting(true);

    try {
      // Create patient profile and register
      const profile = {
        name: formData.fullName.trim(),
        dateOfBirth: formData.dateOfBirth,
        aadhar: formData.aadharNumber.trim(),
        phone: formData.phoneNumber.trim(),
        gender: formData.gender,
        role: 'patient'
      };
      
      await registerPatient(formData.email.trim(), formData.password, profile);
      actions.setUser({ ...profile, email: formData.email.trim() });
      setSubmitSuccess('Account created successfully');
      navigate('/success', { state: { userType: 'patient' } });
    } catch (err) {
      setSubmitError(err?.message || 'Failed to create account');
    } finally {
      setIsSubmitting(false);
    }
  };

  const handleBackToSignIn = () => {
    navigate('/patient-signin');
  };

  const handleBackToHome = () => {
    navigate('/');
  };

  const containerVariants = {
    hidden: { opacity: 0, y: 20 },
    visible: { opacity: 1, y: 0, transition: { duration: 0.6, ease: 'easeOut', staggerChildren: 0.1 } }
  };

  const itemVariants = {
    hidden: { opacity: 0, y: 20 },
    visible: { opacity: 1, y: 0, transition: { duration: 0.4, ease: 'easeOut' } }
  };

  return (
    <section className="min-h-[calc(100vh-4rem)] grid place-items-center py-10">
      <div className="w-full max-w-2xl mx-auto px-4">
        <motion.div className="rounded-2xl soft-shadow border border-neutral-200 dark:border-neutral-800 bg-white/80 dark:bg-neutral-900/70 backdrop-blur p-6 sm:p-8" variants={containerVariants} initial="hidden" animate="visible">
          <motion.div variants={itemVariants} className="flex items-center justify-between mb-8">
            <button onClick={handleBackToHome} className="text-sm text-neutral-600 dark:text-neutral-300 hover:text-neutral-900 dark:hover:text-white inline-flex items-center gap-2 focus-ring">
              <span>‚Üê</span>
              <span>{t('back')}</span>
            </button>
            <button onClick={handleBackToHome} className="text-sm text-neutral-600 dark:text-neutral-300 hover:text-neutral-900 dark:hover:text-white inline-flex items-center gap-2 focus-ring">
              <span>üè†</span>
              <span>{t('homeCta')}</span>
            </button>
          </motion.div>

          <motion.div variants={itemVariants} className="text-center mb-8">
            <div className="w-20 h-20 mx-auto mb-4 rounded-full bg-brand-500/10 text-brand-700 dark:text-brand-300 grid place-items-center">
              <motion.svg xmlns="http://www.w3.org/2000/svg" className="w-10 h-10" viewBox="0 0 24 24" fill="currentColor" animate={{ scale: [1, 1.05, 1], rotate: [0, 2, -2, 0] }} transition={{ duration: 4, repeat: Infinity, ease: 'easeInOut' }}>
                <path d="M12 13a4 4 0 1 0-4-4 4 4 0 0 0 4 4Zm6 8H6a1 1 0 0 1-1-1 7 7 0 0 1 14 0 1 1 0 0 1-1 1Z"/>
              </motion.svg>
            </div>
            <h2 className="text-3xl sm:text-4xl font-extrabold mb-2 text-brand-600 dark:text-brand-400">{t('patientRegistration')}</h2>
            <p className="text-neutral-600 dark:text-neutral-300 text-lg">{t('patientRegistrationSubtitle')}</p>
          </motion.div>

          <motion.form variants={itemVariants} onSubmit={handleSubmit} className="space-y-6">
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium mb-2 text-neutral-700 dark:text-neutral-300" htmlFor="fullName">{t('fullName')} <span className="text-red-500">*</span></label>
                <input id="fullName" name="fullName" type="text" value={formData.fullName} onChange={handleInputChange} className={`w-full px-4 py-3 rounded-lg bg-neutral-100 dark:bg-neutral-900 border transition-colors focus-ring ${errors.fullName ? 'border-red-500 focus:border-red-500' : 'border-neutral-200 dark:border-neutral-800 focus:border-brand-500'}`} />
                {errors.fullName && <motion.p initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} className="text-red-500 text-sm mt-1">{errors.fullName}</motion.p>}
              </div>
              <div>
                <label className="block text-sm font-medium mb-2 text-neutral-700 dark:text-neutral-300" htmlFor="dateOfBirth">{t('dateOfBirth')} <span className="text-red-500">*</span></label>
                <input id="dateOfBirth" name="dateOfBirth" type="date" value={formData.dateOfBirth} onChange={handleInputChange} className={`w-full px-4 py-3 rounded-lg bg-neutral-100 dark:bg-neutral-900 border transition-colors focus-ring ${errors.dateOfBirth ? 'border-red-500 focus:border-red-500' : 'border-neutral-200 dark:border-neutral-800 focus:border-brand-500'}`} />
                {errors.dateOfBirth && <motion.p initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} className="text-red-500 text-sm mt-1">{errors.dateOfBirth}</motion.p>}
              </div>
              <div>
                <label className="block text-sm font-medium mb-2 text-neutral-700 dark:text-neutral-300" htmlFor="aadharNumber">{t('aadharNumber')} <span className="text-red-500">*</span></label>
                <input id="aadharNumber" name="aadharNumber" type="text" value={formData.aadharNumber} onChange={handleInputChange} placeholder="12-digit Aadhar" className={`w-full px-4 py-3 rounded-lg bg-neutral-100 dark:bg-neutral-900 border transition-colors focus-ring ${errors.aadharNumber ? 'border-red-500 focus:border-red-500' : 'border-neutral-200 dark:border-neutral-800 focus:border-brand-500'}`} />
                {errors.aadharNumber && <motion.p initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} className="text-red-500 text-sm mt-1">{errors.aadharNumber}</motion.p>}
                <p className="text-xs text-neutral-500 dark:text-neutral-400 mt-1">
                  Your Aadhaar details will be verified against our registry
                </p>
              </div>
              <div>
                <label className="block text-sm font-medium mb-2 text-neutral-700 dark:text-neutral-300" htmlFor="phoneNumber">{t('phoneNumber')} <span className="text-red-500">*</span></label>
                <input 
                  id="phoneNumber" 
                  name="phoneNumber" 
                  type="tel" 
                  value={formData.phoneNumber} 
                  onChange={handleInputChange} 
                  placeholder="Enter your phone number (e.g., 9876543210)"
                  className={`w-full px-4 py-3 rounded-lg bg-neutral-100 dark:bg-neutral-900 border transition-colors focus-ring ${errors.phoneNumber ? 'border-red-500 focus:border-red-500' : 'border-neutral-200 dark:border-neutral-800 focus:border-brand-500'}`} 
                />
                {errors.phoneNumber && <motion.p initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} className="text-red-500 text-sm mt-1">{errors.phoneNumber}</motion.p>}
                <p className="text-xs text-neutral-500 dark:text-neutral-400 mt-1">
                  Enter your 10-digit mobile number. Country code (+91) will be added automatically.
                </p>
              </div>
              <div>
                <label className="block text-sm font-medium mb-2 text-neutral-700 dark:text-neutral-300" htmlFor="gender">Gender <span className="text-red-500">*</span></label>
                <select id="gender" name="gender" value={formData.gender} onChange={handleInputChange} className={`w-full px-4 py-3 rounded-lg bg-neutral-100 dark:bg-neutral-900 border transition-colors focus-ring ${errors.gender ? 'border-red-500 focus:border-red-500' : 'border-neutral-200 dark:border-neutral-800 focus:border-brand-500'}`}>
                  <option value="">Select</option>
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                  <option value="other">Other</option>
                </select>
                {errors.gender && <motion.p initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} className="text-red-500 text-sm mt-1">{errors.gender}</motion.p>}
              </div>
              <div>
                <label className="block text-sm font-medium mb-2 text-neutral-700 dark:text-neutral-300" htmlFor="email">{t('email')} <span className="text-red-500">*</span></label>
                <input id="email" name="email" type="email" value={formData.email} onChange={handleInputChange} className={`w-full px-4 py-3 rounded-lg bg-neutral-100 dark:bg-neutral-900 border transition-colors focus-ring ${errors.email ? 'border-red-500 focus:border-red-500' : 'border-neutral-200 dark:border-neutral-800 focus:border-brand-500'}`} />
                {errors.email && <motion.p initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} className="text-red-500 text-sm mt-1">{errors.email}</motion.p>}
              </div>
            </div>


            {/* Phone OTP Verification Section */}
            <div className="rounded-lg border border-neutral-200 dark:border-neutral-800 bg-neutral-50 dark:bg-neutral-900/50 p-4">
              <div className="flex items-center justify-between mb-3">
                <h3 className="text-sm font-semibold text-neutral-700 dark:text-neutral-300">Phone Verification</h3>
                {otpVerified && (
                  <span className="text-green-600 dark:text-green-400 text-sm font-medium">‚úì Verified</span>
                )}
              </div>
              
              {!otpSent ? (
                <div className="space-y-2">
                  <button
                    type="button"
                    onClick={handleSendOTP}
                    disabled={!formData.phoneNumber.trim()}
                    className="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-brand-600 hover:bg-brand-700 disabled:bg-brand-400 text-white text-sm font-medium focus-ring transition-colors"
                  >
                    <span>üì±</span>
                    <span>Send OTP</span>
                  </button>
                  <button
                    type="button"
                    onClick={() => {
                      console.log('reCAPTCHA status:', recaptchaVerifier.current ? 'Initialized' : 'Not initialized');
                      console.log('reCAPTCHA container exists:', !!document.getElementById('recaptcha-container'));
                    }}
                    className="text-xs text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300"
                  >
                    Debug reCAPTCHA
                  </button>
                </div>
              ) : (
                <div className="space-y-3">
                  <div className="flex items-center gap-2">
                    <span className="text-sm text-neutral-600 dark:text-neutral-400">Enter 6-digit OTP:</span>
                  </div>
                  <div className="flex gap-2 justify-center">
                    {otpCode.map((digit, index) => (
                      <input
                        key={index}
                        ref={el => otpInputRefs.current[index] = el}
                        type="text"
                        inputMode="numeric"
                        maxLength="1"
                        value={digit}
                        onChange={(e) => handleOtpChange(index, e.target.value)}
                        onKeyDown={(e) => handleOtpKeyDown(index, e)}
                        className="w-12 h-12 text-center text-lg font-semibold rounded-lg bg-neutral-100 dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20 transition-colors"
                      />
                    ))}
                  </div>
                  <div className="flex gap-2 justify-center">
                    <button
                      type="button"
                      onClick={handleVerifyOTP}
                      disabled={otpVerifying || otpCode.join('').length !== 6}
                      className="inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white text-sm font-medium focus-ring transition-colors"
                    >
                      {otpVerifying ? (
                        <>
                          <motion.div
                            className="w-4 h-4 border-2 border-white border-t-transparent rounded-full"
                            animate={{ rotate: 360 }}
                            transition={{ duration: 1, repeat: Infinity, ease: "linear" }}
                          />
                          <span>Verifying...</span>
                        </>
                      ) : (
                        <>
                          <span>‚úì</span>
                          <span>Verify OTP</span>
                        </>
                      )}
                    </button>
                    <button
                      type="button"
                      onClick={() => {
                        setOtpSent(false);
                        setOtpVerified(false);
                        setOtpCode(['', '', '', '', '', '']);
                        setOtpMessage('');
                      }}
                      className="inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg border border-neutral-300 dark:border-neutral-700 hover:bg-neutral-100 dark:hover:bg-neutral-800 text-neutral-700 dark:text-neutral-300 text-sm font-medium focus-ring transition-colors"
                    >
                      <span>‚Üª</span>
                      <span>Resend</span>
                    </button>
                  </div>
                </div>
              )}
              
              {otpMessage && (
                <motion.p 
                  initial={{ opacity: 0, y: -10 }}
                  animate={{ opacity: 1, y: 0 }}
                  className={`text-sm mt-2 ${otpVerified ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}`}
                >
                  {otpMessage}
                </motion.p>
              )}
              {errors.phoneVerification && (
                <motion.p initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} className="text-red-500 text-sm mt-1">{errors.phoneVerification}</motion.p>
              )}
            </div>

            <div>
              <label className="block text-sm font-medium mb-2 text-neutral-700 dark:text-neutral-300" htmlFor="password">{t('password')} <span className="text-red-500">*</span></label>
              <div className="relative">
                <input id="password" name="password" type={showPassword ? 'text' : 'password'} value={formData.password} onChange={handleInputChange} className={`w-full px-4 py-3 pr-12 rounded-lg bg-neutral-100 dark:bg-neutral-900 border transition-colors focus-ring ${errors.password ? 'border-red-500 focus:border-red-500' : 'border-neutral-200 dark:border-neutral-800 focus:border-brand-500'}`} />
                <button type="button" onClick={() => setShowPassword(!showPassword)} className="absolute right-3 top-1/2 -translate-y-1/2 text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300 focus-ring rounded">
                  {showPassword ? (
                    <motion.svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" whileHover={{ scale: 1.1 }}>
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                      <circle cx="12" cy="12" r="3"/>
                    </motion.svg>
                  ) : (
                    <motion.svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" whileHover={{ scale: 1.1 }}>
                      <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                      <line x1="1" y1="1" x2="23" y2="23"/>
                    </motion.svg>
                  )}
                </button>
              </div>
              {errors.password && <motion.p initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} className="text-red-500 text-sm mt-1">{errors.password}</motion.p>}
              
              {/* Password strength indicator */}
              {formData.password && (
                <div className="mt-2 text-xs text-neutral-600 dark:text-neutral-400">
                  <div className="mb-1">Password requirements:</div>
                  <div className="grid grid-cols-1 sm:grid-cols-2 gap-1">
                    <div className={`flex items-center gap-1 ${formData.password.length >= 8 ? 'text-green-600 dark:text-green-400' : 'text-neutral-500'}`}>
                      <span>{formData.password.length >= 8 ? '‚úì' : '‚óã'}</span>
                      <span>8+ characters</span>
                    </div>
                    <div className={`flex items-center gap-1 ${/[A-Z]/.test(formData.password) ? 'text-green-600 dark:text-green-400' : 'text-neutral-500'}`}>
                      <span>{/[A-Z]/.test(formData.password) ? '‚úì' : '‚óã'}</span>
                      <span>Uppercase letter</span>
                    </div>
                    <div className={`flex items-center gap-1 ${/[a-z]/.test(formData.password) ? 'text-green-600 dark:text-green-400' : 'text-neutral-500'}`}>
                      <span>{/[a-z]/.test(formData.password) ? '‚úì' : '‚óã'}</span>
                      <span>Lowercase letter</span>
                    </div>
                    <div className={`flex items-center gap-1 ${/\d/.test(formData.password) ? 'text-green-600 dark:text-green-400' : 'text-neutral-500'}`}>
                      <span>{/\d/.test(formData.password) ? '‚úì' : '‚óã'}</span>
                      <span>Number</span>
                    </div>
                    <div className={`flex items-center gap-1 ${/[!@#$%^&*]/.test(formData.password) ? 'text-green-600 dark:text-green-400' : 'text-neutral-500'}`}>
                      <span>{/[!@#$%^&*]/.test(formData.password) ? '‚úì' : '‚óã'}</span>
                      <span>Special character</span>
                    </div>
                  </div>
                </div>
              )}
            </div>

            <div>
              <label className="block text-sm font-medium mb-2 text-neutral-700 dark:text-neutral-300" htmlFor="confirmPassword">{t('confirmPassword')} <span className="text-red-500">*</span></label>
              <div className="relative">
                <input id="confirmPassword" name="confirmPassword" type={showConfirmPassword ? 'text' : 'password'} value={formData.confirmPassword} onChange={handleInputChange} className={`w-full px-4 py-3 pr-12 rounded-lg bg-neutral-100 dark:bg-neutral-900 border transition-colors focus-ring ${errors.confirmPassword ? 'border-red-500 focus:border-red-500' : 'border-neutral-200 dark:border-neutral-800 focus:border-brand-500'}`} />
                <button type="button" onClick={() => setShowConfirmPassword(!showConfirmPassword)} className="absolute right-3 top-1/2 -translate-y-1/2 text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300 focus-ring rounded">
                  {showConfirmPassword ? (
                    <motion.svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" whileHover={{ scale: 1.1 }}>
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                      <circle cx="12" cy="12" r="3"/>
                    </motion.svg>
                  ) : (
                    <motion.svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" whileHover={{ scale: 1.1 }}>
                      <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                      <line x1="1" y1="1" x2="23" y2="23"/>
                    </motion.svg>
                  )}
                </button>
              </div>
              {errors.confirmPassword && <motion.p initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} className="text-red-500 text-sm mt-1">{errors.confirmPassword}</motion.p>}
            </div>

            {/* reCAPTCHA Container */}
            <motion.div className="pt-2" whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }}>
              {submitError && (
                <div className="mb-3 text-sm text-red-600 dark:text-red-400">{submitError}</div>
              )}
              {submitSuccess && (
                <div className="mb-3 text-sm text-green-600 dark:text-green-400">{submitSuccess}</div>
              )}
              
              {/* Verification Status */}
              <button 
                type="submit" 
                disabled={isSubmitting} 
                className="w-full inline-flex items-center justify-center gap-3 px-6 py-4 rounded-lg bg-brand-600 hover:bg-brand-700 disabled:bg-brand-400 text-white font-semibold text-lg focus-ring transition-colors"
              >
                {isSubmitting ? (
                  <>
                    <motion.div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full" animate={{ rotate: 360 }} transition={{ duration: 1, repeat: Infinity, ease: 'linear' }} />
                    <span>Creating...</span>
                  </>
                ) : (
                  <>
                    <motion.svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" whileHover={{ scale: 1.1 }}>
                      <path d="M12 5v14M5 12h14"/>
                    </motion.svg>
                    <span>{t('create')}</span>
                  </>
                )}
              </button>
            </motion.div>

            <motion.div className="text-center pt-6 border-t border-neutral-200 dark:border-neutral-800" whileHover={{ scale: 1.02 }}>
              <p className="text-neutral-600 dark:text-neutral-400 mb-3">{t('alreadyHaveAccount')}</p>
              <button type="button" onClick={handleBackToSignIn} className="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-brand-600 text-brand-600 dark:text-brand-400 font-semibold hover:bg-brand-50 dark:hover:bg-brand-900/20 focus-ring transition-colors">
                <motion.svg xmlns="http://www.w3.org/2000/svg" className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" whileHover={{ scale: 1.1 }}>
                  <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                  <polyline points="10,17 15,12 10,7"/>
                  <line x1="15" y1="12" x2="3" y2="12"/>
                </motion.svg>
                <span>{t('signIn')}</span>
              </button>
            </motion.div>
          </motion.form>
        </motion.div>
      </div>
    </section>
  );
}


